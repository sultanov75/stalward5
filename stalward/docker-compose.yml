version: "3.9"

services:
  app_proxy:
    environment:
      APP_HOST: stalwart_server_1
      APP_PORT: 8080
      PROXY_AUTH_ADD: "false"

  server:
    image: stalwartlabs/stalwart:v0.15.4@sha256:2a25f80a42a96aaeaa6f07062eb23bcbacfcc27c38bbad163ff5126554e6744c
    container_name: stalwart_server_1
    user: "1000:1000"
    restart: on-failure

    ports:
      - 10443:443
      - 10025:25
      - 10465:465
      - 10587:587
      - 10143:143
      - 10993:993
      - 14190:4190
      - 10110:110
      - 10995:995

    volumes:
      # –î–∞–Ω–Ω—ã–µ Stalwart
      - ${APP_DATA_DIR}/data:/opt/stalwart

      # üîê –ì–û–¢–û–í–´–ï TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (read-only!)
      - /home/umbrel/certs:/certs:ro

    environment:
      # üåê –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
      STALWART_HOSTNAME: mail.555333.ru
      STALWART_DOMAIN: 555333.ru

      # üîê –Ø–í–ù–û —É–∫–∞–∑—ã–≤–∞–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
      STALWART_TLS_CERT: /certs/fullchain.pem
      STALWART_TLS_KEY: /certs/privkey.pem

      # ‚ùå –∑–∞–ø—Ä–µ—â–∞–µ–º –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é
      STALWART_TLS_AUTO: "false"
